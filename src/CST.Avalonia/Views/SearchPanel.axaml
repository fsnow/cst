<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:CST.Avalonia.ViewModels"
             xmlns:models="using:CST.Avalonia.Models"
             x:Class="CST.Avalonia.Views.SearchPanel"
             x:DataType="vm:SearchViewModel"
             Name="SearchPanelControl">
  
  <UserControl.Styles>
    <Style Selector="TextBlock.section-header">
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="0,8,0,4"/>
      <Setter Property="FontSize" Value="12"/>
    </Style>
    
    <Style Selector="TextBlock.count-badge">
      <Setter Property="FontSize" Value="11"/>
      <Setter Property="Foreground" Value="{DynamicResource SystemAccentColor}"/>
      <Setter Property="FontWeight" Value="Medium"/>
    </Style>
    
    <Style Selector="Border.search-section">
      <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
      <Setter Property="CornerRadius" Value="6"/>
      <Setter Property="Padding" Value="12"/>
      <Setter Property="Margin" Value="8"/>
    </Style>
    
    <Style Selector="ToggleSwitch.filter-switch">
      <Setter Property="Margin" Value="4,2"/>
    </Style>
    
    <!-- Alternating row colors for better readability -->
    <Style Selector="ListBoxItem:nth-child(2n)">
      <Setter Property="Background">
        <Setter.Value>
          <SolidColorBrush Color="#08000000"/>
        </Setter.Value>
      </Setter>
    </Style>
    
    <!-- Hover effect for list items -->
    <Style Selector="ListBoxItem:pointerover">
      <Setter Property="Background">
        <Setter.Value>
          <SolidColorBrush Color="#15000000"/>
        </Setter.Value>
      </Setter>
    </Style>
    
    <!-- Selected item styling -->
    <Style Selector="ListBoxItem:selected">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColorLight3}"/>
      <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}"/>
    </Style>
  </UserControl.Styles>

  <Grid RowDefinitions="Auto,*,Auto">
    
    <!-- Search Input Area -->
    <Border Grid.Row="0" Classes="search-section">
      <StackPanel>
        <!-- Search Field -->
        <TextBlock Classes="section-header" Text="Search Terms"/>
        <TextBox Name="SearchInput" 
                 Text="{Binding SearchText}"
                 Watermark="Enter search terms..."
                 Margin="0,4,0,8">
          <TextBox.KeyBindings>
            <KeyBinding Gesture="Enter" Command="{Binding SearchCommand}"/>
            <KeyBinding Gesture="Escape" Command="{Binding ClearCommand}"/>
          </TextBox.KeyBindings>
        </TextBox>
        
        <!-- Search Mode Selector -->
        <TextBlock Classes="section-header" Text="Search Mode"/>
        <ComboBox Name="SearchModeCombo" 
                  ItemsSource="{Binding SearchModes}"
                  SelectedItem="{Binding SelectedSearchMode}"
                  Margin="0,4,0,8">
          <ComboBox.ItemTemplate>
            <DataTemplate>
              <TextBlock Text="{Binding DisplayName}"/>
            </DataTemplate>
          </ComboBox.ItemTemplate>
        </ComboBox>
        
        <!-- Collection Filter (Placeholder) -->
        <TextBlock Classes="section-header" Text="Book Collection"/>
        <ComboBox Name="CollectionFilter" 
                  SelectedIndex="0"
                  Margin="0,4,0,8">
          <ComboBoxItem Content="All Books"/>
          <ComboBoxItem Content="Custom Collections..." IsEnabled="False"/>
        </ComboBox>
        
        <!-- Book Type Filters -->
        <Expander Header="Filter by Collection" IsExpanded="False" Margin="0,4,0,0">
          <StackPanel Margin="8,8,0,0">
            <!-- Pitaka Filters -->
            <TextBlock Text="Pitaka:" FontWeight="Medium" FontSize="11" Margin="0,0,0,4"/>
            <WrapPanel Margin="0,0,0,8">
              <ToggleSwitch Classes="filter-switch" Content="Vinaya" 
                           IsChecked="{Binding IncludeVinaya}" FontSize="11"/>
              <ToggleSwitch Classes="filter-switch" Content="Sutta" 
                           IsChecked="{Binding IncludeSutta}" FontSize="11"/>
              <ToggleSwitch Classes="filter-switch" Content="Abhidhamma" 
                           IsChecked="{Binding IncludeAbhidhamma}" FontSize="11"/>
            </WrapPanel>
            
            <!-- Commentary Level Filters -->
            <TextBlock Text="Commentary Level:" FontWeight="Medium" FontSize="11" Margin="0,4,0,4"/>
            <WrapPanel Margin="0,0,0,8">
              <ToggleSwitch Classes="filter-switch" Content="Mūla" 
                           IsChecked="{Binding IncludeMula}" FontSize="11"/>
              <ToggleSwitch Classes="filter-switch" Content="Aṭṭhakathā" 
                           IsChecked="{Binding IncludeAttha}" FontSize="11"/>
              <ToggleSwitch Classes="filter-switch" Content="Ṭīkā" 
                           IsChecked="{Binding IncludeTika}" FontSize="11"/>
            </WrapPanel>
            
            <!-- Other Texts -->
            <ToggleSwitch Classes="filter-switch" Content="Other Texts" 
                         IsChecked="{Binding IncludeOther}" FontSize="11"/>
          </StackPanel>
        </Expander>
      </StackPanel>
    </Border>
    
    <!-- Search Results -->
    <Grid Grid.Row="1" ColumnDefinitions="*,4,*" Margin="8,0">
      
      <!-- Terms List -->
      <Border Grid.Column="0" 
              Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="6" Padding="8">
        <Grid RowDefinitions="Auto,*">
          <TextBlock Grid.Row="0" Classes="section-header" Text="Matching Terms"/>
          
          <ListBox Grid.Row="1" Name="TermsList"
                   ItemsSource="{Binding Terms}"
                   SelectionMode="Multiple"
                   Background="Transparent"
                   BorderThickness="0">
            <ListBox.ItemTemplate>
              <DataTemplate x:DataType="vm:MatchingTermViewModel">
                <Grid ColumnDefinitions="*,Auto" MinHeight="24" Margin="0,0,14,0">
                  <TextBlock Grid.Column="0" 
                            Text="{Binding DisplayTerm}" 
                            VerticalAlignment="Center"
                            TextWrapping="NoWrap"
                            TextTrimming="CharacterEllipsis"
                            FontSize="11"/>
                  <Border Grid.Column="1" 
                         Background="{DynamicResource SystemAccentColorLight2}"
                         CornerRadius="10"
                         Padding="6,2"
                         Margin="4,0,0,0"
                         MinWidth="20"
                         MinHeight="18">
                    <TextBlock Text="{Binding TotalCount}"
                              FontSize="10"
                              FontWeight="Medium"
                              Foreground="{DynamicResource SystemAccentColorDark1}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"/>
                  </Border>
                </Grid>
              </DataTemplate>
            </ListBox.ItemTemplate>
            
            <!-- Compact item styling to match Books list -->
            <ListBox.Styles>
              <Style Selector="ListBoxItem">
                <Setter Property="Padding" Value="4"/>
                <Setter Property="MinHeight" Value="0"/>
              </Style>
            </ListBox.Styles>
          </ListBox>
        </Grid>
      </Border>
      
      <GridSplitter Grid.Column="1" 
                    Background="{DynamicResource CardStrokeColorDefaultBrush}"
                    Width="1"
                    HorizontalAlignment="Center"/>
      
      <!-- Book Occurrences -->
      <Border Grid.Column="2" 
              Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="6" Padding="8">
        <Grid RowDefinitions="Auto,*">
          <TextBlock Grid.Row="0" Classes="section-header" Text="Books"/>
          
          <ListBox Grid.Row="1" Name="OccurrencesList"
                   ItemsSource="{Binding Occurrences}"
                   Background="Transparent"
                   BorderThickness="0">
            <ListBox.ItemTemplate>
              <DataTemplate x:DataType="vm:BookOccurrenceViewModel">
                <Grid ColumnDefinitions="*,Auto" MinHeight="24" Margin="0,0,14,0">
                  <TextBlock Grid.Column="0" 
                            Text="{Binding DisplayName}" 
                            VerticalAlignment="Center"
                            TextWrapping="NoWrap"
                            TextTrimming="CharacterEllipsis"
                            FontSize="11"/>
                  <Border Grid.Column="1" 
                         Background="{DynamicResource SystemAccentColorLight2}"
                         CornerRadius="10"
                         Padding="6,2"
                         Margin="4,0,0,0"
                         MinWidth="20"
                         MinHeight="18">
                    <TextBlock Text="{Binding Count}"
                              FontSize="10"
                              FontWeight="Medium"
                              Foreground="{DynamicResource SystemAccentColorDark1}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"/>
                  </Border>
                </Grid>
              </DataTemplate>
            </ListBox.ItemTemplate>
            
            <!-- Double-click to open book -->
            <ListBox.Styles>
              <Style Selector="ListBoxItem">
                <Setter Property="Padding" Value="4"/>
                <Setter Property="MinHeight" Value="0"/>
              </Style>
            </ListBox.Styles>
          </ListBox>
        </Grid>
      </Border>
    </Grid>
    
    <!-- Status Bar -->
    <Border Grid.Row="2" 
            Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
            Padding="12,8"
            Margin="8">
      <Grid ColumnDefinitions="*,*">
        <!-- Statistics aligned with Terms and Books columns -->
        <TextBlock Grid.Column="0" 
                   Text="{Binding TermStats}"
                   FontSize="11"
                   VerticalAlignment="Center"/>
        <TextBlock Grid.Column="1" 
                   Text="{Binding OccurrenceStats}"
                   FontSize="11"
                   VerticalAlignment="Center"/>
      </Grid>
    </Border>
    
  </Grid>
</UserControl>