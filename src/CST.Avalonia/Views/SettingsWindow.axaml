<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CST.Avalonia.ViewModels"
        x:Class="CST.Avalonia.Views.SettingsWindow"
        x:DataType="vm:SettingsViewModel"
        Title="Settings"
        Width="900" Height="600"
        MinWidth="700" MinHeight="400"
        WindowStartupLocation="CenterOwner">
    
    <Window.Styles>
        <Style Selector="TextBlock.SectionTitle">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style Selector="TextBlock.SettingLabel">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>
        
        <Style Selector="TextBlock.SettingDescription">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
        
        <Style Selector="Border.SettingGroup">
            <Setter Property="Background" Value="#F5F5F5"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
        </Style>
    </Window.Styles>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header with Search -->
        <Border Grid.Row="0" Background="#F0F0F0" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <DockPanel Margin="20,10">
                <TextBlock Text="Settings" FontSize="18" FontWeight="Bold" 
                          VerticalAlignment="Center" DockPanel.Dock="Left"/>
                
                <TextBox Text="{Binding SearchQuery}" 
                        Watermark="Search settings..."
                        Width="300"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        DockPanel.Dock="Right"/>
            </DockPanel>
        </Border>
        
        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Category List -->
            <Border Grid.Column="0" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
                <ListBox ItemsSource="{Binding Categories}" 
                         SelectedItem="{Binding SelectedCategory}"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="vm:SettingsCategoryViewModel">
                            <Border Padding="15,10" Background="Transparent">
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Description}" 
                                              FontSize="11" 
                                              Foreground="Gray"
                                              TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.Styles>
                        <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                            <Setter Property="Background" Value="#E0E0E0"/>
                        </Style>
                    </ListBox.Styles>
                </ListBox>
            </Border>
            
            <!-- Settings Content -->
            <ScrollViewer Grid.Column="1" Padding="20">
                <ContentControl Content="{Binding SelectedCategory.Content}">
                    <ContentControl.DataTemplates>
                        
                        <!-- General Settings Template -->
                        <DataTemplate DataType="vm:GeneralSettingsViewModel">
                            <StackPanel>
                                <TextBlock Text="General" Classes="SectionTitle"/>
                                
                                <Border Classes="SettingGroup">
                                    <StackPanel>
                                        <TextBlock Text="XML Books Directory" Classes="SettingLabel"/>
                                        <DockPanel>
                                            <Button Content="Browse..." 
                                                   Command="{Binding BrowseCommand}"
                                                   DockPanel.Dock="Right" 
                                                   Margin="5,0,0,0"
                                                   Width="80"/>
                                            <TextBox Text="{Binding XmlBooksDirectory}" 
                                                    IsReadOnly="True"/>
                                        </DockPanel>
                                        <TextBlock Text="Location of the Tipitaka XML book files" 
                                                  Classes="SettingDescription"/>
                                        
                                        <StackPanel Margin="0,15,0,0">
                                            <TextBlock Text="Index Directory" Classes="SettingLabel"/>
                                            <DockPanel>
                                                <Button Content="Browse..." 
                                                       Command="{Binding BrowseIndexCommand}"
                                                       DockPanel.Dock="Right" 
                                                       Margin="5,0,0,0"
                                                       Width="80"/>
                                                <TextBox Text="{Binding IndexDirectory}" 
                                                        Watermark="Default location will be used if empty"/>
                                            </DockPanel>
                                            <TextBlock Text="Location where search index files are stored (leave empty for default location)" 
                                                      Classes="SettingDescription"/>
                                        </StackPanel>
                                        
                                        <CheckBox Content="Show Welcome screen on startup" 
                                                 IsChecked="{Binding ShowWelcomeOnStartup}"
                                                 Margin="0,10,0,0"/>
                                        
                                        <StackPanel Margin="0,15,0,0">
                                            <TextBlock Text="Maximum recent books" Classes="SettingLabel"/>
                                            <NumericUpDown Value="{Binding MaxRecentBooks}" 
                                                          Minimum="5" Maximum="50" Increment="5"
                                                          Width="100" HorizontalAlignment="Left"/>
                                            <TextBlock Text="Number of recent books to remember" 
                                                      Classes="SettingDescription"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </DataTemplate>
                        
                        <!-- Appearance Settings Template -->
                        <DataTemplate DataType="vm:AppearanceSettingsViewModel">
                            <StackPanel>
                                <TextBlock Text="Appearance" Classes="SectionTitle"/>
                                
                                <Border Classes="SettingGroup">
                                    <StackPanel>
                                        <TextBlock Text="Theme" Classes="SettingLabel"/>
                                        <ComboBox ItemsSource="{Binding Themes}" 
                                                 SelectedItem="{Binding Theme}"
                                                 Width="200" HorizontalAlignment="Left"/>
                                        <TextBlock Text="Choose between light, dark, or automatic theme" 
                                                  Classes="SettingDescription"/>
                                    </StackPanel>
                                </Border>
                                
                                <Border Classes="SettingGroup">
                                    <StackPanel>
                                        <TextBlock Text="Pali Script Fonts" Classes="SettingLabel"/>
                                        <TextBlock Text="Configure fonts for each Pali script used in books and search results" 
                                                  Classes="SettingDescription"/>
                                        
                                        <Grid Margin="0,10,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="150"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Script List -->
                                            <ListBox Grid.Column="0" 
                                                    ItemsSource="{Binding ScriptFontSettings}"
                                                    SelectedItem="{Binding SelectedScript}"
                                                    Height="200">
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate x:DataType="vm:ScriptFontSettingViewModel">
                                                        <TextBlock Text="{Binding ScriptName}" Padding="5"/>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>
                                            
                                            <!-- Font Settings for Selected Script -->
                                            <StackPanel Grid.Column="1" Margin="15,0,0,0">
                                                <TextBlock Text="{Binding SelectedScript.ScriptName, StringFormat='Font settings for {0}'}" 
                                                          FontWeight="SemiBold" Margin="0,0,0,10"/>
                                                
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="80"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Font:" 
                                                              VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                    <DockPanel Grid.Row="0" Grid.Column="1" Margin="0,0,0,10">
                                                        <ProgressBar IsIndeterminate="True"
                                                                     IsVisible="{Binding SelectedScript.IsLoadingFonts}"
                                                                     Width="100" Height="5"
                                                                     VerticalAlignment="Center" Margin="10,0,0,0"
                                                                     DockPanel.Dock="Right"/>
                                                        <ComboBox ItemsSource="{Binding SelectedScript.AvailableFonts}"
                                                                  SelectedItem="{Binding SelectedScript.SelectedFontFamily}"
                                                                  IsEnabled="{Binding !SelectedScript.IsLoadingFonts}"/>
                                                    </DockPanel>
                                                    
                                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Size:" 
                                                              VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                    <NumericUpDown Grid.Row="1" Grid.Column="1" 
                                                                  Value="{Binding SelectedScript.FontSize}"
                                                                  Minimum="8" Maximum="32" Increment="1"
                                                                  Width="120" HorizontalAlignment="Left"
                                                                  Margin="0,0,0,10"/>
                                                    
                                                    <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                                                              Text="Preview:" Margin="0,10,0,5"/>
                                                    <Border Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                                           BorderBrush="#E0E0E0" BorderThickness="1"
                                                           Background="White" Padding="10" Height="60">
                                                        <TextBlock Text="{Binding SelectedScript.PreviewText}"
                                                                  FontFamily="{Binding SelectedScript.EffectiveFontFamilyObject}"
                                                                  FontSize="{Binding SelectedScript.FontSize}"
                                                                  VerticalAlignment="Center"
                                                                  Foreground="Black"/>
                                                    </Border>
                                                    
                                                    <!-- System Default Font Information -->
                                                    <TextBlock Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                                              Margin="0,8,0,0"
                                                              FontSize="12"
                                                              Foreground="Gray"
                                                              IsVisible="{Binding SelectedScript.SystemDefaultFontName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                        <Run Text="System Default font is "/>
                                                        <Run Text="{Binding SelectedScript.SystemDefaultFontName}" FontWeight="Medium"/>
                                                    </TextBlock>
                                                </Grid>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </Border>
                                
                                <Border Classes="SettingGroup">
                                    <StackPanel>
                                        <TextBlock Text="UI Localization Font" Classes="SettingLabel"/>
                                        <TextBlock Text="Font for user interface elements (menus, buttons, etc.)" 
                                                  Classes="SettingDescription"/>
                                        
                                        <Grid Margin="0,10,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="200"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Font:" 
                                                      VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <TextBox Grid.Row="0" Grid.Column="1" 
                                                    Text="{Binding LocalizationFontFamily}" 
                                                    Watermark="System default"
                                                    Margin="0,0,0,10"/>
                                            
                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Size:" 
                                                      VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <NumericUpDown Grid.Row="1" Grid.Column="1" 
                                                          Value="{Binding LocalizationFontSize}"
                                                          Minimum="8" Maximum="24" Increment="1"
                                                          Width="120" HorizontalAlignment="Left"/>
                                        </Grid>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </DataTemplate>
                        
                        <!-- Search Settings Template -->
                        <DataTemplate DataType="vm:SearchSettingsViewModel">
                            <StackPanel>
                                <TextBlock Text="Search" Classes="SectionTitle"/>
                                
                                <Border Classes="SettingGroup">
                                    <StackPanel>
                                        <CheckBox Content="Case sensitive search" 
                                                 IsChecked="{Binding CaseSensitive}"
                                                 Margin="0,0,0,10"/>
                                        
                                        <CheckBox Content="Match whole words only" 
                                                 IsChecked="{Binding WholeWords}"
                                                 Margin="0,0,0,10"/>
                                        
                                        <CheckBox Content="Use regular expressions" 
                                                 IsChecked="{Binding UseRegex}"
                                                 Margin="0,0,0,15"/>
                                        
                                        <TextBlock Text="Maximum search results" Classes="SettingLabel"/>
                                        <NumericUpDown Value="{Binding MaxSearchResults}" 
                                                      Minimum="100" Maximum="10000" Increment="100"
                                                      Width="150" HorizontalAlignment="Left"/>
                                        <TextBlock Text="Limit the number of search results to improve performance" 
                                                  Classes="SettingDescription"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </DataTemplate>
                        
                        <!-- Advanced Settings Template -->
                        <DataTemplate DataType="vm:AdvancedSettingsViewModel">
                            <StackPanel>
                                <TextBlock Text="Advanced" Classes="SectionTitle"/>
                                
                                <Border Classes="SettingGroup">
                                    <StackPanel>
                                        <TextBlock Text="Configuration" Classes="SettingLabel"/>
                                        <TextBlock Text="Settings are stored in JSON format" 
                                                  Classes="SettingDescription"/>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                            <TextBlock Text="Settings file: " VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding SettingsFilePath}" 
                                                      FontFamily="Consolas,Courier New,monospace"
                                                      VerticalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <Button Content="Open Settings Folder" 
                                               Command="{Binding OpenSettingsFileCommand}"
                                               Margin="0,10,0,0"
                                               Width="150" HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </DataTemplate>
                        
                        <!-- Developer Settings Template -->
                        <DataTemplate DataType="vm:DeveloperSettingsViewModel">
                            <StackPanel>
                                <TextBlock Text="Developer" Classes="SectionTitle"/>
                                
                                <Border Classes="SettingGroup">
                                    <StackPanel>
                                        <TextBlock Text="Logging" Classes="SettingLabel"/>
                                        <TextBlock Text="Configure application logging for debugging and troubleshooting" 
                                                  Classes="SettingDescription"/>
                                        
                                        <StackPanel Margin="0,10,0,15">
                                            <TextBlock Text="Log Level" Classes="SettingLabel"/>
                                            <ComboBox ItemsSource="{Binding LogLevels}" 
                                                     SelectedItem="{Binding LogLevel}"
                                                     Width="200" HorizontalAlignment="Left"/>
                                            <TextBlock Text="Controls how much detail is written to log files" 
                                                      Classes="SettingDescription"/>
                                        </StackPanel>
                                        
                                        <Button Content="Open Logs Folder" 
                                               Command="{Binding OpenLogsCommand}"
                                               Width="150" HorizontalAlignment="Left"/>
                                        <TextBlock Text="Opens the folder containing application log files" 
                                                  Classes="SettingDescription"/>
                                        
                                        <Button Content="Test Font Detection" 
                                               Command="{Binding TestFontDetectionCommand}"
                                               Width="150" HorizontalAlignment="Left"
                                               Margin="0,10,0,0"/>
                                        <TextBlock Text="POC: Test detection of actual fonts used for Pali scripts" 
                                                  Classes="SettingDescription"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </DataTemplate>
                        
                    </ContentControl.DataTemplates>
                </ContentControl>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>